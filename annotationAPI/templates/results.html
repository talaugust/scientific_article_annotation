<!-- templates/consent.html-->
{% extends 'litw_base.html' %}

{% load widget_tweaks %}

{% load static %}

{% block content %}

<div class="row mb-3">
	<h1 class="LITWbolded-blue"> Nice work! You have the eyes of an expert writer!  
	</h1>
</div>

<div class="row mb-3">
	<p> When reading news articles you identified {{ total_strategies }} total strategie(s). This is similar to experts and other readers, who identified {{ expert_strategies }} total strategies in similar articles. Below you can see the breakdown of the different strategies you identified and those identified by expert readers. Note that these are not all the different strategies you may have highlighted, but a subset of the most common ones. </p>
</div>

<div class="row mt-5 pb-5 justify-content-md-center" id="title"></div>

<div class="row justify-content-md-center" id="vis_anchor"></div>

<div class="row justify-content-md-center" id="caption"></div>


<div class="row mt-5 pb-5 justify-content-md-center" id="examples"></div>

<div class="row"> <h3 class="LITWbolded-blue"> Interested in learning more? </h3> </div>

<div class="row">
	<p> This study explores how science news articles, blogs, and press releases communicate new scientific findings to a diverse audience of readers. By analyzing scientific communication books and training materials, we identified writing strategies that are recommended for science writing, like explaining scientific concepts or using analogies. </p>
	<p> We are curious how these writing strategies get used in actual science communication. Your annotations will help us identify when these strategies get used, and how effective they are. Thank you! </p>
	<p> If you are interested in learning more, check out these great resources: </p>
</div>

<div class="row">
	<ul> 
		<li> <a href="https://www.reddit.com/r/science"> r/Science </a>: A forum dedicated to communicating and discussing scientific topics. </li>
		<li> <a href="https://en.wikipedia.org/wiki/Science_communication"> Wikipedia on science communication. </a> </li>
	</ul>
</div>

<div class="row mt-5 pb-5" id="examples">
	<a  href="{% url 'random-article-detail' HIT='LITW' HITclass='all' %}" class="btn btn-primary">Try another article!</a>
</div>




<script src="https://d3js.org/d3.v5.min.js"></script>
<script type="text/javascript">

	// add the SVG element
	var svg = d3.select("#vis_anchor").append("svg"),
    	margin = {top: 20, right: 20, bottom: 30, left: 40},
    	width = 550 - margin.left - margin.right,
    	height = 300 - margin.top - margin.bottom;

    var caption = d3.select("#caption").insert("text")
    				.text("Frequency of identified writing strategies. Click on a bar to see example highlights.")

    var text_examples = d3.select("#examples").append("text")
    						.attr("fill", "#000")


	var g = svg.attr("width", width + margin.left + margin.right)
    	.attr("height", height + margin.top + margin.bottom)
    	.append("g")
    	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // get the data	https://litw-sci-scomm.azurewebsites.net/api/results
	$.ajax({
	  url: "http://localhost:8000/api/results",
	  type: "get", //send it through get method
	  data: { article: localStorage.getItem("id")},
	  success: function(response) {
		  	var columns = ['Type', 'You', 'Expert']
			var examples = 
			{
				'LEAD': {
					"You": "",
					"Expert": "The toxic effects of lead—developmental delays, organ damage, even death—are well-known. But millions of Americans still rely on lead pipes to deliver drinking water",
				},
				'MAIN': {
					"You": "",
					"Expert": "In an attempt to make them safer, researchers at the University of California, Berkeley, are working on a new technology that uses electrical current to rapidly build a protective layer on the insides of the pipes.",
				},
				'IMPACT':{
					"You": "",
					"Expert": "According to the authors, this integrated approach is a first step in providing metrics aimed at unifying the psychology and neurophysiology of chronic pain across diverse clinical conditions.",
				},
				'PERSONAL':{
					"You": "",
					"Expert": "\"I never would have imagined we would reach this in my lifetime,\" says Sandholm, a professor of computer science at Carnegie Mellon University.",
				},
				'STORY':{
					"You": "",
					"Expert": "So 66 million years ago, when an asteroid hit the planet, it blocked out the sun for several months, which turned off photosynthesis, causing the food web to collapse",
				}
			};

		  	console.log(response);
		  	var data = response['results'];
		  	for (ex in examples) {
		  		examples[ex]['You'] = response['examples'][ex];
		  	}
		  	console.log(examples);
	    	//make the graph
	      	var groupKey = columns[0]
		  	var keys = columns.slice(1)	

		  	const color = d3.scaleOrdinal(d3.schemeCategory10).range(["#98abc5", "#7b6888", "#ff8c00"]);


		   	var x0 = d3.scaleBand()
			    .domain(data.map(d => d[groupKey]))
			    .rangeRound([margin.left, width - margin.right])
			    .paddingInner(0.1)

			var x1 = d3.scaleBand()
			    .domain(keys)
			    .rangeRound([0, x0.bandwidth()])
			    .padding(0.05)

			var y = d3.scaleLinear()
				.rangeRound([height, 0 + margin.top])
				.domain([0, d3.max(data, d => d3.max(keys, key => d[key]))]).nice()

			var xAxis = g => g
			    .attr("transform", `translate(0,${height})`)
			    .call(d3.axisBottom(x0).tickSizeOuter(0))
			    .call(g => g.select(".domain").remove())

			var yAxis = g => g
			    .attr("transform", `translate(${margin.left},0)`)
			    .call(d3.axisLeft(y).ticks(null, "s"))
			    .call(g => g.select(".domain").remove())
			    .call(g => g.select(".tick:last-of-type text").clone()
			        .attr("x", 3)
			        .attr("text-anchor", "start")
			        .attr("font-weight", "bold")
			        .text(data.y))

			var legend = g.append("g")
		            .attr("font-family", "sans-serif")
		            .attr("font-size", 10)
		            .attr("text-anchor", "end")
		            .selectAll("g")
		            .data(keys.slice().reverse())
		            .enter().append("g")
		            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

		        legend.append("rect")
		            .attr("x", width - 17)
		            .attr("width", 15)
		            .attr("height", 15)
		            .attr("fill", color)
		            .attr("stroke", color)
		            .attr("stroke-width",2);

		        legend.append("text")
		            .attr("x", width - 24)
		            .attr("y", 9.5)
		            .attr("dy", "0.32em")
		            .text(function(d) { return d; });
				
				  svg.append("g")
				    .call(xAxis);

				  svg.append("g")
				    .call(yAxis);


			      svg.append("g")
				    .selectAll("g")
				    .data(data)
				    .join("g")
				      .attr("transform", d => `translate(${x0(d[groupKey])},0)`)
				    .selectAll("rect")
				    .data(d => keys.map(key => ({key, value: d[key], type: d[groupKey]})))
				    .join("rect")
				      .attr("x", d => x1(d.key))
				      .attr("y", d => y(d.value))
				      .attr("width", x1.bandwidth())
				      .attr("height", d => y(0) - y(d.value))		
				      .attr("fill", d => color(d.key))
					  .on("click", function(d) {
					  	console.log(d);
			   		text_examples.text('Example sentence: ' + examples[d['type']][d['key']])
				});
	  },
	  error: function(xhr) {
	    //Do Something to handle error
	    console.log(xhr);
	  }
	});

</script>

{% endblock %}